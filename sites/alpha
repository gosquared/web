server {
  server_name alpha.gosquared.com;

  set $root_host alpha.gosquared.com;
  rewrite ^/developer/?$ https://$root_host/docs/ permanent;

  location  ~ ^/(login|logout|reset|home|neo|now|trends|ecommerce|settings|integration|welcome|people|demo|announcements|setup|chat|inbox|_notify|automation|visitors|forms|insights)(/.*)?$ {
    proxy_set_header x-forwarded-proto https;
    proxy_next_upstream error timeout http_500 http_502 http_503 http_504;
    proxy_pass http://neo_alpha;
  }

  location / {
    include include/hide_s3_headers;

    proxy_hide_header Access-Control-Allow-Origin;
    proxy_hide_header Access-Control-Allow-Methods;
    proxy_hide_header Access-Control-Allow-Headers;
    proxy_hide_header Access-Control-Allow-Credentials;

    proxy_set_header Host alpha.gosquared.com;
    error_page 403 =404 /error-4xx.html;

    set $backend_upstream "http://alpha.gosquared.com.s3-website-us-east-1.amazonaws.com";
    resolver 10.0.0.2 8.8.8.8 ipv6=off;
    proxy_pass $backend_upstream;
  }
}
